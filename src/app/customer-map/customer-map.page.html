<ion-header [translucent]="true" class="map-header">
  <ion-toolbar>
    <div class="header-content">
      <ion-button fill="clear" color="light" (click)="goBack()" slot="start">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
      
      <div class="header-title">
        <ion-icon name="restaurant-outline"></ion-icon>
        <span>Find Karenderias</span>
      </div>

      <ion-button fill="clear" color="light" (click)="refreshLocation()" slot="end">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="map-content">
  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-container">
      <ion-searchbar 
        placeholder="Search karenderias..."
        [debounce]="500"
        (ionInput)="onSearchInput($event)"
        class="map-searchbar">
      </ion-searchbar>
    </div>

    <div class="filter-chips">
      <ion-chip 
        [color]="selectedFilter === 'all' ? 'primary' : 'medium'"
        (click)="onFilterChange('all')"
        class="filter-chip">
        <ion-label>All</ion-label>
      </ion-chip>
      
      <ion-chip 
        [color]="selectedFilter === 'open' ? 'success' : 'medium'"
        (click)="onFilterChange('open')"
        class="filter-chip">
        <ion-icon name="time-outline"></ion-icon>
        <ion-label>Open Now</ion-label>
      </ion-chip>
      
      <ion-chip 
        [color]="selectedFilter === 'nearby' ? 'warning' : 'medium'"
        (click)="onFilterChange('nearby')"
        class="filter-chip">
        <ion-icon name="location-outline"></ion-icon>
        <ion-label>Nearby</ion-label>
      </ion-chip>
      
      <ion-chip 
        [color]="selectedFilter === 'rated' ? 'tertiary' : 'medium'"
        (click)="onFilterChange('rated')"
        class="filter-chip">
        <ion-icon name="star-outline"></ion-icon>
        <ion-label>Top Rated</ion-label>
      </ion-chip>
    </div>

    <div class="range-container">
      <div class="range-header">
        <ion-label>Search Range: {{formatSearchRadius()}}</ion-label>
        <ion-badge color="primary" *ngIf="!isLoading">
          {{karenderias.length}} found
        </ion-badge>
      </div>
      <ion-range 
        [min]="500" 
        [max]="5000" 
        [step]="100"
        [(ngModel)]="searchRadius"
        (ionChange)="onRangeChange()"
        color="primary"
        class="search-range">
        <ion-label slot="start">500m</ion-label>
        <ion-label slot="end">5km</ion-label>
      </ion-range>
    </div>
  </div>

  <!-- Map Container -->
  <div class="map-container">
    <app-map 
      [lat]="currentLat" 
      [lng]="currentLng" 
      [zoom]="mapZoom"
      [isLocationPickerMode]="false"
      [searchRadiusMeters]="searchRadius">
    </app-map>
  </div>

  <!-- Floating Action Buttons -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-list side="top">
      <ion-fab-button color="danger" (click)="clearRoutes()" class="clear-route-fab">
        <ion-icon name="close-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>

</ion-content>