<ion-content class="settings-content">
  <!-- Mobile Top Bar (visible only on mobile) -->
  <div class="mobile-top-bar">
    <div class="mobile-brand">
      <div class="brand-icon">{{getKarenderiaBrandInitials()}}</div>
      <div class="brand-info">
        <h3>{{getKarenderiaDisplayName()}}</h3>
        <span>Settings</span>
      </div>
    </div>
    <div class="mobile-actions">
      <ion-button fill="clear" size="small" routerLink="/karenderia-settings">
        <ion-icon name="person-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" size="small" (click)="logout()">
        <ion-icon name="log-out-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

  <div class="settings-layout">
    <!-- Left Sidebar Navigation -->
    <div class="settings-sidebar">
      <div class="sidebar-header">
        <div class="brand">
          <div class="brand-icon">{{getKarenderiaBrandInitials()}}</div>
          <div class="brand-info">
            <h3>{{getKarenderiaDisplayName()}}</h3>
            <span>Kitchen</span>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <a class="nav-item" routerLink="/karenderia-dashboard">
          <ion-icon name="grid-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Dashboard</span>
        </a>
        <a class="nav-item" routerLink="/karenderia-menu">
          <ion-icon name="restaurant-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Menu Management</span>
        </a>
        <a class="nav-item" routerLink="/daily-menu-management">
          <ion-icon name="calendar-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Menu of the Day</span>
        </a>
        <a class="nav-item" routerLink="/inventory-management">
          <ion-icon name="cube-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Inventory</span>
        </a>
        <a class="nav-item" routerLink="/karenderia-analytics">
          <ion-icon name="analytics-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Analytics</span>
        </a>
        <a class="nav-item active" routerLink="/karenderia-settings">
          <ion-icon name="settings-outline" class="nav-icon"></ion-icon>
          <span class="nav-text">Profile</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <a class="nav-item" (click)="logout()">
          <ion-icon name="log-out-outline"></ion-icon>
          <span>Sign Out</span>
        </a>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="settings-main">
      <!-- Header -->
      <div class="settings-header">
        <div class="header-content">
          <h1>Settings</h1>
          <p>Manage your carinderia settings and preferences</p>
        </div>
        <div class="header-actions">
          <button class="save-btn" (click)="saveChanges()">
            <ion-icon name="save-outline"></ion-icon>
            Save Changes
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="settings-content-area">
        <!-- Settings Tabs -->
        <div class="settings-tabs">
          <div class="tabs-container">
            <button 
              class="tab-btn active" 
              [class.active]="selectedTab === 'business'"
              (click)="selectTab('business')">
              Business Info
            </button>
            <button 
              class="tab-btn" 
              [class.active]="selectedTab === 'operations'"
              (click)="selectTab('operations')">
              Operations
            </button>
            <button 
              class="tab-btn" 
              [class.active]="selectedTab === 'notifications'"
              (click)="selectTab('notifications')">
              Notifications
            </button>
            <button 
              class="tab-btn" 
              [class.active]="selectedTab === 'account'"
              (click)="selectTab('account')">
              Account
            </button>
          </div>
        </div>

        <!-- Business Information Tab -->
        <div *ngIf="selectedTab === 'business'" class="tab-content">
          <div class="settings-section">
            <h2>Business Information</h2>
            
            <!-- Business Logo Section -->
            <div class="form-group logo-section">
              <label>Business Logo</label>
              <div class="logo-upload-area">
                <div class="current-logo">
                  <div class="logo-preview">
                    <span class="logo-text">LR</span>
                  </div>
                </div>
                <div class="upload-controls">
                  <button class="upload-btn" (click)="uploadLogo()">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Upload Logo
                  </button>
                  <p class="upload-hint">Recommended size: 200x200px</p>
                </div>
              </div>
            </div>

            <!-- Business Details Form -->
            <div class="form-row">
              <div class="form-group">
                <label for="businessName">Business Name</label>
                <input 
                  type="text" 
                  id="businessName"
                  [(ngModel)]="businessInfo.name"
                  placeholder="Enter business name">
              </div>
              <div class="form-group">
                <label for="phoneNumber">Phone Number</label>
                <input 
                  type="tel" 
                  id="phoneNumber"
                  [(ngModel)]="businessInfo.phone"
                  placeholder="Enter phone number">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="emailAddress">Email Address</label>
                <input 
                  type="email" 
                  id="emailAddress"
                  [(ngModel)]="businessInfo.email"
                  placeholder="Enter email address">
              </div>
              <div class="form-group">
                <label for="cuisineType">Cuisine Type</label>
                <select id="cuisineType" [(ngModel)]="businessInfo.cuisineType">
                  <option value="filipino">Filipino</option>
                  <option value="chinese">Chinese</option>
                  <option value="korean">Korean</option>
                  <option value="japanese">Japanese</option>
                  <option value="fusion">Fusion</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="businessDescription">Business Description</label>
              <textarea 
                id="businessDescription"
                [(ngModel)]="businessInfo.description"
                placeholder="Describe your restaurant..."
                rows="4"></textarea>
            </div>

            <div class="form-group">
              <label for="address">Address</label>
              <textarea 
                id="address"
                [(ngModel)]="businessInfo.address"
                placeholder="Enter complete business address..."
                rows="3"></textarea>
            </div>

            <!-- Location Coordinates -->
            <div class="form-group">
              <label>Business Location Coordinates</label>
              <p class="form-description">Set your exact location so customers can find you on the map</p>
              <div class="form-row">
                <div class="form-group">
                  <label for="latitude">Latitude</label>
                  <input 
                    type="number" 
                    id="latitude"
                    [(ngModel)]="businessInfo.latitude"
                    placeholder="e.g., 14.5995"
                    step="any"
                    min="-90"
                    max="90">
                </div>
                <div class="form-group">
                  <label for="longitude">Longitude</label>
                  <input 
                    type="number" 
                    id="longitude"
                    [(ngModel)]="businessInfo.longitude"
                    placeholder="e.g., 120.9842"
                    step="any"
                    min="-180"
                    max="180">
                </div>
              </div>
              <div class="location-helpers">
                <button type="button" class="helper-btn" (click)="getCurrentLocation()">
                  <ion-icon name="location-outline"></ion-icon>
                  Use Current Location
                </button>
                <button type="button" class="helper-btn" (click)="openMapPicker()">
                  <ion-icon name="map-outline"></ion-icon>
                  Pick on Map
                </button>
                <button type="button" class="helper-btn" (click)="openMapPicker()">
                  <ion-icon name="navigate-outline"></ion-icon>
                  Interactive Map
                </button>
              </div>
              
              <!-- Interactive Map Modal (hidden by default) -->
              <div class="map-modal" [class.active]="showMapModal">
                <div class="map-modal-content">
                  <div class="map-header">
                    <h3>Set Your Business Location</h3>
                    <button class="close-btn" (click)="closeMapModal()">
                      <ion-icon name="close"></ion-icon>
                    </button>
                  </div>
                  
                  <div class="map-instructions">
                    <p><ion-icon name="information-circle"></ion-icon> Tap anywhere on the map to set your business location</p>
                  </div>
                  
                  <div class="map-container" #mapContainer>
                    <div class="simple-map" (click)="onMapClick($event)">
                      <!-- Simple clickable map area -->
                      <div class="map-grid">
                        <div class="grid-line"></div>
                        <div class="grid-line"></div>
                        <div class="grid-line"></div>
                        <div class="grid-line"></div>
                      </div>
                      
                      <!-- Business pin marker -->
                      <div class="business-pin" 
                           [style.left.%]="pinPosition.x" 
                           [style.top.%]="pinPosition.y"
                           *ngIf="pinPosition.x !== null">
                        <ion-icon name="location"></ion-icon>
                      </div>
                      
                      <div class="map-overlay">
                        <p>📍 Tap to place your business here</p>
                      </div>
                    </div>
                  </div>
                  
                  <div class="coordinates-display" *ngIf="tempCoordinates.lat">
                    <p><strong>Selected Location:</strong></p>
                    <p>Latitude: {{tempCoordinates.lat | number:'1.6-6'}}</p>
                    <p>Longitude: {{tempCoordinates.lng | number:'1.6-6'}}</p>
                  </div>
                  
                  <div class="map-actions">
                    <button class="action-btn secondary" (click)="useCurrentLocationOnMap()">
                      <ion-icon name="locate"></ion-icon>
                      Use My Location
                    </button>
                    <button class="action-btn primary" 
                            (click)="confirmMapLocation()" 
                            [disabled]="!tempCoordinates.lat">
                      <ion-icon name="checkmark"></ion-icon>
                      Confirm Location
                    </button>
                  </div>
                </div>
              </div>
              <p class="location-note">
                <ion-icon name="information-circle-outline"></ion-icon>
                Your business will only appear to customers after admin approval
              </p>
            </div>
          </div>
        </div>

        <!-- Operations Tab -->
        <div *ngIf="selectedTab === 'operations'" class="tab-content">
          <div class="settings-section">
            <h2>Operations Settings</h2>
            
            <!-- Operating Hours -->
            <div class="form-group">
              <label>Operating Hours</label>
              <div class="operating-hours">
                <div *ngFor="let day of operatingHours" class="day-schedule">
                  <div class="day-name">{{ day.name }}</div>
                  <div class="day-controls">
                    <label class="toggle-switch">
                      <input type="checkbox" [(ngModel)]="day.isOpen">
                      <span class="toggle-slider"></span>
                    </label>
                    <div *ngIf="day.isOpen" class="time-inputs">
                      <input type="time" [(ngModel)]="day.openTime">
                      <span>to</span>
                      <input type="time" [(ngModel)]="day.closeTime">
                    </div>
                    <span *ngIf="!day.isOpen" class="closed-text">Closed</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications Tab -->
        <div *ngIf="selectedTab === 'notifications'" class="tab-content">
          <div class="settings-section">
            <h2>Notification Preferences</h2>
            
            <div class="form-group">
              <label>System Notifications</label>
              <div class="notification-settings">
                <label class="checkbox-group">
                  <input type="checkbox" [(ngModel)]="notificationSettings.systemUpdates">
                  <span class="checkmark"></span>
                  System updates
                </label>
                <label class="checkbox-group">
                  <input type="checkbox" [(ngModel)]="notificationSettings.promotionalEmails">
                  <span class="checkmark"></span>
                  Promotional emails
                </label>
              </div>
            </div>

            <div class="form-group">
              <label>Notification Methods</label>
              <div class="notification-methods">
                <label class="checkbox-group">
                  <input type="checkbox" [(ngModel)]="notificationSettings.emailNotifications">
                  <span class="checkmark"></span>
                  Email notifications
                </label>
                <label class="checkbox-group">
                  <input type="checkbox" [(ngModel)]="notificationSettings.smsNotifications">
                  <span class="checkmark"></span>
                  SMS notifications
                </label>
                <label class="checkbox-group">
                  <input type="checkbox" [(ngModel)]="notificationSettings.pushNotifications">
                  <span class="checkmark"></span>
                  Push notifications
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Account Tab -->
        <div *ngIf="selectedTab === 'account'" class="tab-content">
          <div class="settings-section">
            <h2>Account Settings</h2>
            
            <div class="form-group">
              <label>Profile Information</label>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name</label>
                  <input 
                    type="text" 
                    id="firstName"
                    [(ngModel)]="accountSettings.firstName"
                    placeholder="Enter first name">
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name</label>
                  <input 
                    type="text" 
                    id="lastName"
                    [(ngModel)]="accountSettings.lastName"
                    placeholder="Enter last name">
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Change Password</label>
              <div class="password-change">
                <div class="form-group">
                  <label for="currentPassword">Current Password</label>
                  <input 
                    type="password" 
                    id="currentPassword"
                    [(ngModel)]="passwordChange.currentPassword"
                    placeholder="Enter current password">
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input 
                      type="password" 
                      id="newPassword"
                      [(ngModel)]="passwordChange.newPassword"
                      placeholder="Enter new password">
                  </div>
                  <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input 
                      type="password" 
                      id="confirmPassword"
                      [(ngModel)]="passwordChange.confirmPassword"
                      placeholder="Confirm new password">
                  </div>
                </div>
                <button class="secondary-btn" (click)="changePassword()">
                  Change Password
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
