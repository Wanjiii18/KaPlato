<ion-header [translucent]="true" class="modern-dashboard-header">
  <ion-toolbar class="gradient-dashboard-toolbar">
    <ion-title>
      <div class="modern-dashboard-title">
        <ion-icon name="business" color="light"></ion-icon>
        <span>Karenderia Suite</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refreshStatus()" color="light" class="modern-refresh-btn">
        <ion-icon name="refresh" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-dashboard-content">
  <div class="modern-dashboard-container animate-fade-in">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="modern-loading-container animate-fade-in">
      <div class="loading-card">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <h3>Loading your karenderia...</h3>
        <p>Getting your business information ready</p>
      </div>
    </div>

    <!-- No Application Found -->
    <div *ngIf="!isLoading && !karenderia" class="modern-no-application animate-slide-up">
      <div class="empty-state-card">
        <div class="empty-icon-circle">
          <ion-icon name="restaurant-outline"></ion-icon>
        </div>
        <h2>Start Your Karenderia Journey</h2>
        <p>You haven't submitted a karenderia application yet. Join our platform and start reaching more customers today!</p>
        
        <div class="benefits-list">
          <div class="benefit-item">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>Advanced Menu Management</span>
          </div>
          <div class="benefit-item">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>Built-in POS System</span>
          </div>
          <div class="benefit-item">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>Inventory & Analytics</span>
          </div>
          <div class="benefit-item">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>Nutrition & Allergen Tracking</span>
          </div>
        </div>
        
        <ion-button expand="block" fill="solid" color="primary" class="register-btn" routerLink="/karenderia-registration">
          <ion-icon name="add" slot="start"></ion-icon>
          Register Your Karenderia
        </ion-button>
      </div>
    </div>

    <!-- Enhanced Dashboard -->
    <div *ngIf="!isLoading && karenderia" class="enhanced-dashboard animate-fade-in">
      
      <!-- Quick Stats Cards -->
      <div class="stats-grid">
        <ion-card class="stat-card sales">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="cash" color="success"></ion-icon>
            </div>
            <div class="stat-content">
              <h2>{{ formatCurrency(dashboardData.todaysSales) }}</h2>
              <p>Today's Sales</p>
              <div class="trend" [ngClass]="getTrendColor(dashboardData.salesTrend)">
                <ion-icon [name]="getTrendIcon(dashboardData.salesTrend)"></ion-icon>
                <span>{{ dashboardData.salesTrend }}%</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card orders">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="restaurant" color="primary"></ion-icon>
            </div>
            <div class="stat-content">
              <h2>{{ dashboardData.todaysOrders }}</h2>
              <p>Orders Today</p>
              <div class="sub-stat">
                <span>{{ dashboardData.pendingOrders }} pending</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card inventory">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="cube-outline" [color]="dashboardData.lowStockItems > 0 ? 'warning' : 'success'"></ion-icon>
            </div>
            <div class="stat-content">
              <h2>{{ dashboardData.lowStockItems }}</h2>
              <p>Low Stock Items</p>
              <div class="action-link" (click)="viewLowStock()">
                <span>View Details</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card menu">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="nutrition-outline" color="secondary"></ion-icon>
            </div>
            <div class="stat-content">
              <h2>{{ dashboardData.allergenCompliantItems }}/{{ dashboardData.activeMenuItems }}</h2>
              <p>Allergen Compliant</p>
              <div class="progress-bar">
                <ion-progress-bar [value]="dashboardData.allergenCompliantItems / dashboardData.activeMenuItems"></ion-progress-bar>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Quick Actions Grid -->
      <div class="quick-actions-grid">
        <h3>Business Management</h3>
        
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="action-card" (click)="navigateToMenuManagement()">
                <div class="action-icon">
                  <ion-icon name="restaurant" color="primary"></ion-icon>
                </div>
                <h4>Menu Management</h4>
                <p>Manage dishes, prices & nutrition</p>
              </div>
            </ion-col>
            
            <ion-col size="6">
              <div class="action-card" (click)="navigateToPOS()">
                <div class="action-icon">
                  <ion-icon name="calculator" color="success"></ion-icon>
                </div>
                <h4>POS System</h4>
                <p>Take orders & process payments</p>
              </div>
            </ion-col>
            
            <ion-col size="6">
              <div class="action-card" (click)="navigateToInventory()">
                <div class="action-icon">
                  <ion-icon name="cube-outline" color="warning"></ion-icon>
                </div>
                <h4>Inventory</h4>
                <p>Track stock & suppliers</p>
              </div>
            </ion-col>
            
            <ion-col size="6">
              <div class="action-card" (click)="navigateToAnalytics()">
                <div class="action-icon">
                  <ion-icon name="bar-chart" color="tertiary"></ion-icon>
                </div>
                <h4>Analytics</h4>
                <p>Sales reports & insights</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

      <!-- Business Information Card -->
      <ion-card class="business-info-card">
        <ion-card-header>
          <div class="card-header-with-status">
            <ion-card-title>{{ karenderia.name }}</ion-card-title>
            <ion-chip [color]="getStatusClass(karenderia.status)" class="status-chip">
              <ion-icon [name]="getStatusIcon(karenderia.status)" slot="start"></ion-icon>
              <ion-label>{{ getStatusText(karenderia.status) }}</ion-label>
            </ion-chip>
          </div>
        </ion-card-header>
        
        <ion-card-content>
          <div class="business-details">
            <div class="detail-item">
              <ion-icon name="location" color="medium"></ion-icon>
              <span>{{ karenderia.address }}</span>
            </div>
            <div class="detail-item" *ngIf="karenderia.phone">
              <ion-icon name="call" color="medium"></ion-icon>
              <span>{{ karenderia.phone }}</span>
            </div>
            <div class="detail-item" *ngIf="karenderia.opening_time && karenderia.closing_time">
              <ion-icon name="time" color="medium"></ion-icon>
              <span>{{ karenderia.opening_time }} - {{ karenderia.closing_time }}</span>
            </div>
          </div>

          <div class="action-buttons">
            <ion-button fill="outline" size="small" (click)="editKarenderia()">
              <ion-icon name="create" slot="start"></ion-icon>
              Edit Details
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

    </div>

    <!-- Floating Action Button -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="karenderia">
      <ion-fab-button color="primary">
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
      
      <ion-fab-list side="top">
        <ion-fab-button color="success" (click)="addMenuItem()">
          <ion-icon name="restaurant"></ion-icon>
        </ion-fab-button>
        
        <ion-fab-button color="warning" (click)="quickOrderStatusUpdate()">
          <ion-icon name="clipboard-outline"></ion-icon>
        </ion-fab-button>
        
        <ion-fab-button color="tertiary" (click)="navigateToAnalytics()">
          <ion-icon name="bar-chart"></ion-icon>
        </ion-fab-button>
      </ion-fab-list>
    </ion-fab>

  </div>
</ion-content>
