<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Register as Karenderia Owner</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="registration-container">
    
    <!-- Step Indicator -->
    <div class="step-indicator">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <div class="step-label">Account</div>
      </div>
      <div class="step-line" [class.completed]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <div class="step-label">Business</div>
      </div>
      <div class="step-line" [class.completed]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <div class="step-number">3</div>
        <div class="step-label">Location</div>
      </div>
    </div>

    <!-- Step 1: Account Registration -->
    <div *ngIf="currentStep === 1" class="step-content">
      <div class="step-header">
        <ion-icon name="person-add-outline" class="step-icon"></ion-icon>
        <h2>Create Your Account</h2>
        <p>First, let's create your karenderia owner account</p>
      </div>

      <form [formGroup]="accountForm" (ngSubmit)="nextStep()">
        <ion-item>
          <ion-input 
            formControlName="name"
            label="Full Name *"
            labelPlacement="stacked"
            placeholder="Enter your full name"
            [class.error]="accountForm.get('name')?.invalid && accountForm.get('name')?.touched">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="email"
            label="Email Address *"
            labelPlacement="stacked"
            placeholder="your@email.com"
            type="email"
            [class.error]="accountForm.get('email')?.invalid && accountForm.get('email')?.touched">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="password"
            label="Password *"
            labelPlacement="stacked"
            placeholder="Minimum 8 characters"
            type="password"
            [class.error]="accountForm.get('password')?.invalid && accountForm.get('password')?.touched">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="password_confirmation"
            label="Confirm Password *"
            labelPlacement="stacked"
            placeholder="Re-enter your password"
            type="password"
            [class.error]="accountForm.get('password_confirmation')?.invalid && accountForm.get('password_confirmation')?.touched">
          </ion-input>
        </ion-item>

        <div class="form-actions">
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="!accountForm.valid || isLoading">
            <ion-icon name="arrow-forward" slot="end"></ion-icon>
            Continue to Business Details
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Step 2: Business Information -->
    <div *ngIf="currentStep === 2" class="step-content">
      <div class="step-header">
        <ion-icon name="restaurant-outline" class="step-icon"></ion-icon>
        <h2>Business Information</h2>
        <p>Tell us about your karenderia</p>
      </div>

      <form [formGroup]="businessForm" (ngSubmit)="nextStep()">
        <ion-item>
          <ion-input 
            formControlName="business_name"
            label="Karenderia Name *"
            labelPlacement="stacked"
            placeholder="e.g., Lola Rosa's Carinderia"
            [class.error]="businessForm.get('business_name')?.invalid && businessForm.get('business_name')?.touched">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-textarea 
            formControlName="description"
            label="Description *"
            labelPlacement="stacked"
            placeholder="Describe your restaurant, specialties, and what makes it unique"
            rows="4"
            [class.error]="businessForm.get('description')?.invalid && businessForm.get('description')?.touched">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="phone"
            label="Contact Number"
            labelPlacement="stacked"
            placeholder="+63 9XX XXX XXXX"
            type="tel">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="business_email"
            label="Business Email"
            labelPlacement="stacked"
            placeholder="business@example.com"
            type="email">
          </ion-input>
        </ion-item>

        <!-- Operating Hours -->
        <div class="form-section">
          <h3>Operating Hours</h3>
          <div class="time-inputs">
            <ion-item>
              <ion-input 
                formControlName="opening_time"
                label="Opening Time"
                labelPlacement="stacked"
                type="time">
              </ion-input>
            </ion-item>
            <ion-item>
              <ion-input 
                formControlName="closing_time"
                label="Closing Time"
                labelPlacement="stacked"
                type="time">
              </ion-input>
            </ion-item>
          </div>
        </div>

        <!-- Operating Days -->
        <div class="form-section">
          <h3>Operating Days</h3>
          <div class="days-grid">
            <ion-checkbox 
              *ngFor="let day of weekDays" 
              [checked]="selectedDays.includes(day.value)"
              (ionChange)="toggleDay(day.value)">
              {{day.label}}
            </ion-checkbox>
          </div>
        </div>

        <div class="form-actions">
          <ion-button 
            fill="outline" 
            expand="block" 
            (click)="previousStep()">
            <ion-icon name="arrow-back" slot="start"></ion-icon>
            Back
          </ion-button>
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="!businessForm.valid || isLoading">
            <ion-icon name="arrow-forward" slot="end"></ion-icon>
            Continue to Location
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Step 3: Business Information Only (No Map) -->
    <div *ngIf="currentStep === 3" class="step-content">
      <div class="step-header">
        <ion-icon name="location-outline" class="step-icon"></ion-icon>
        <h2>Business Address</h2>
        <p>Provide your business address. The admin will set your exact map location after approval.</p>
      </div>

      <form [formGroup]="locationForm" (ngSubmit)="submitApplication()">
        <ion-item>
          <ion-textarea 
            formControlName="address"
            label="Complete Business Address *"
            labelPlacement="stacked"
            placeholder="Street, Barangay, City, Province (Be as detailed as possible)"
            rows="4"
            [class.error]="locationForm.get('address')?.invalid && locationForm.get('address')?.touched">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="city"
            label="City *"
            labelPlacement="stacked"
            placeholder="e.g., Quezon City, Manila, Cebu City">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="province"
            label="Province *"
            labelPlacement="stacked"
            placeholder="e.g., Metro Manila, Cebu, Davao">
          </ion-input>
        </ion-item>

        <div class="address-note">
          <ion-icon name="information-circle-outline"></ion-icon>
          <p><strong>Important:</strong> Provide the most accurate address possible. Our admin team will use this information to set your exact location on the map for customers to find you easily.</p>
        </div>

        <!-- Delivery Information -->
        <div class="form-section">
          <h3>Delivery Information</h3>
          <div class="delivery-inputs">
            <ion-item>
              <ion-input 
                formControlName="delivery_fee"
                label="Delivery Fee (â‚±)"
                labelPlacement="stacked"
                placeholder="25"
                type="number"
                min="0">
              </ion-input>
            </ion-item>
            <ion-item>
              <ion-input 
                formControlName="delivery_time_minutes"
                label="Delivery Time (minutes)"
                labelPlacement="stacked"
                placeholder="30"
                type="number"
                min="0">
              </ion-input>
            </ion-item>
          </div>
        </div>

        <!-- Payment Methods -->
        <div class="form-section">
          <h3>Payment Methods</h3>
          <ion-item>
            <ion-checkbox formControlName="accepts_cash"></ion-checkbox>
            <ion-label class="payment-label">Accept Cash on Delivery</ion-label>
          </ion-item>
          <ion-item>
            <ion-checkbox formControlName="accepts_online_payment"></ion-checkbox>
            <ion-label class="payment-label">Accept Online Payment (GCash, PayMaya, etc.)</ion-label>
          </ion-item>
        </div>

        <div class="form-actions">
          <ion-button 
            fill="outline" 
            expand="block" 
            (click)="previousStep()">
            <ion-icon name="arrow-back" slot="start"></ion-icon>
            Back
          </ion-button>
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="!locationForm.valid || isSubmitting">
            <ion-icon name="send" slot="start"></ion-icon>
            {{isSubmitting ? 'Submitting Application...' : 'Submit Application'}}
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Application Submitted -->
    <div *ngIf="currentStep === 4" class="step-content success-step">
      <div class="success-content">
        <ion-icon name="checkmark-circle" class="success-icon"></ion-icon>
        <h2>Application Submitted!</h2>
        <p>Your karenderia application has been submitted successfully. Our admin team will review your application and notify you once approved.</p>
        
        <div class="next-steps">
          <h3>What happens next?</h3>
          <ul>
            <li>Admin reviews your business information and location</li>
            <li>You'll receive an email notification about the approval status</li>
            <li>Once approved, your karenderia will appear on the customer map</li>
            <li>You can start managing your menu and taking orders</li>
          </ul>
        </div>

        <div class="form-actions">
          <ion-button 
            expand="block" 
            fill="solid"
            routerLink="/karenderia-dashboard">
            <ion-icon name="speedometer" slot="start"></ion-icon>
            View Dashboard
          </ion-button>
          <ion-button 
            expand="block" 
            fill="outline"
            routerLink="/home">
            <ion-icon name="home" slot="start"></ion-icon>
            Back to Home
          </ion-button>
        </div>
      </div>
    </div>

  </div>
</ion-content>
