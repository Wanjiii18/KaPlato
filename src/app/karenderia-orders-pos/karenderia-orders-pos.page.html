<div class="modern-header">
  <ion-header [translucent]="true">
    <ion-toolbar class="gradient-toolbar">
      <ion-buttons slot="start">
        <ion-button class="modern-back-btn" fill="clear" defaultHref="/karenderia-dashboard">
          <ion-icon name="arrow-back"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title class="page-title">
        <ion-icon name="calculator"></ion-icon>
        Point of Sale
      </ion-title>
      <ion-buttons slot="end">
        <ion-button class="header-action-btn" (click)="showDetailedAnalytics()" fill="clear">
          <ion-icon name="analytics"></ion-icon>
        </ion-button>
        <ion-button class="header-action-btn" (click)="showOrderHistory()" fill="clear">
          <ion-icon name="time"></ion-icon>
        </ion-button>
        <ion-button class="header-action-btn" (click)="showSettings()" fill="clear">
          <ion-icon name="settings"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
</div>

<ion-content [fullscreen]="true" class="modern-content">
  <div class="pos-container">
    
    <!-- Modern Analytics Bar -->
    <div class="modern-analytics-bar" *ngIf="todaysAnalytics">
      <div class="analytics-card">
        <div class="metric sales">
          <div class="metric-icon">
            <ion-icon name="cash"></ion-icon>
          </div>
          <div class="metric-content">
            <span class="value">{{ formatPhp(todaysAnalytics.totalSales) }}</span>
            <span class="label">Today's Sales</span>
          </div>
        </div>
        <div class="metric orders">
          <div class="metric-icon">
            <ion-icon name="receipt"></ion-icon>
          </div>
          <div class="metric-content">
            <span class="value">{{ todaysAnalytics.totalOrders }}</span>
            <span class="label">Orders</span>
          </div>
        </div>
        <div class="metric profit">
          <div class="metric-icon">
            <ion-icon name="trending-up"></ion-icon>
          </div>
          <div class="metric-content">
            <span class="value">{{ formatPhp(todaysAnalytics.totalProfit) }}</span>
            <span class="label">Profit</span>
          </div>
        </div>
        <div class="metric seasonal">
          <div class="metric-icon">
            <ion-icon name="calendar"></ion-icon>
          </div>
          <div class="metric-content">
            <span class="value">{{ getCurrentSeason() | titlecase }}</span>
            <span class="label">Season</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modern Menu Section -->
    <div class="modern-menu-section">
      
      <!-- Modern Categories -->
      <div class="modern-categories-section">
        <div class="section-header">
          <h3>Choose Category</h3>
          <p>Select a category to view available items</p>
        </div>
        <div class="categories-grid">
          <div 
            *ngFor="let category of categories" 
            class="category-card"
            [class.active]="selectedCategory === category.id"
            (click)="selectCategory(category.id)">
            <div class="category-icon">
              <ion-icon [name]="category.icon"></ion-icon>
            </div>
            <div class="category-info">
              <span class="category-name">{{ category.name }}</span>
              <span class="category-count">{{ getCategoryItemCount(category.id) }} items</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Modern Menu Items -->
      <div class="modern-menu-items-section">
        <div class="section-header">
          <div class="header-info">
            <h3>{{ getSelectedCategoryName() }} Menu</h3>
            <span class="item-count">{{ getFilteredMenuItems().length }} available items</span>
          </div>
          <div class="header-actions">
            <ion-button fill="outline" size="small" (click)="searchItems()">
              <ion-icon name="search" slot="start"></ion-icon>
              Search
            </ion-button>
          </div>
        </div>
        
        <div class="menu-items-grid">
          <div 
            *ngFor="let item of getFilteredMenuItems()" 
            class="modern-menu-item-card"
            (click)="addToOrder(item)">
            <div class="item-image-container">
              <img [src]="item.image" [alt]="item.name" (error)="handleImageError($event)">
              <div class="item-badges">
                <ion-chip *ngIf="item.isPopular" color="warning" class="popular-badge">
                  <ion-icon name="star" slot="start"></ion-icon>
                  Popular
                </ion-chip>
                <ion-chip *ngIf="item.name.includes('Thai')" color="danger" class="spicy-badge">
                  <ion-icon name="flame" slot="start"></ion-icon>
                  Spicy
                </ion-chip>
              </div>
            </div>
            <div class="item-content">
              <div class="item-header">
                <h4 class="item-name">{{ item.name }}</h4>
                <span class="item-price">{{ formatPhp(item.price) }}</span>
              </div>
              <div class="item-details">
                <div class="item-meta">
                  <span class="prep-time">
                    <ion-icon name="time"></ion-icon>
                    {{ item.preparationTime }} min
                  </span>
                  <span class="availability" [class.low-stock]="(item.stock || 0) < 10">
                    <ion-icon name="cube"></ion-icon>
                    {{ item.stock || 'In Stock' }}
                  </span>
                </div>
              </div>
              <ion-button 
                expand="block" 
                fill="solid" 
                class="add-to-order-btn"
                [disabled]="item.stock === 0">
                <ion-icon name="add" slot="start"></ion-icon>
                {{ item.stock === 0 ? 'Out of Stock' : 'Add to Order' }}
              </ion-button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: Current Order (Bills) -->
    <div class="order-section">
      <div class="bills-header">
        <h3>Bills</h3>
        <ion-button fill="clear" size="small" (click)="clearOrder()" *ngIf="currentOrder.length > 0">
          <ion-icon name="trash-outline"></ion-icon>
          Clear
        </ion-button>
      </div>

      <!-- Order Items -->
      <div class="order-items" *ngIf="currentOrder.length > 0">
        <div *ngFor="let orderItem of currentOrder; let i = index" class="order-item">
          <div class="item-details">
            <div class="item-image-small">
              <img [src]="orderItem.menuItem.image" [alt]="orderItem.menuItem.name" (error)="handleImageError($event)">
            </div>
            <div class="item-info-small">
              <h5>{{ orderItem.menuItem.name }}</h5>
              <p class="item-price-small">{{ formatPhp(orderItem.menuItem.price) }}</p>
            </div>
          </div>
          <div class="quantity-controls">
            <ion-button fill="clear" size="small" (click)="updateQuantity(i, orderItem.quantity - 1)">
              <ion-icon name="remove"></ion-icon>
            </ion-button>
            <span class="quantity">{{ orderItem.quantity }}</span>
            <ion-button fill="clear" size="small" (click)="updateQuantity(i, orderItem.quantity + 1)">
              <ion-icon name="add"></ion-icon>
            </ion-button>
          </div>
          <button class="remove-item-btn" (click)="removeFromOrder(i)">
            <ion-icon name="close"></ion-icon>
          </button>
        </div>
      </div>

      <!-- Empty Order State -->
      <div class="empty-order" *ngIf="currentOrder.length === 0">
        <ion-icon name="receipt-outline" size="large"></ion-icon>
        <p>No items in order</p>
        <span>Select items from the menu to add to your order</span>
      </div>

      <!-- Order Summary -->
      <div class="order-summary" *ngIf="currentOrder.length > 0">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>{{ formatPhp(getOrderTotal()) }}</span>
        </div>
        <div class="summary-row">
          <span>Tax</span>
          <span>{{ formatPhp(0) }}</span>
        </div>
        <div class="summary-row total-row">
          <span>Total</span>
          <span>{{ formatPhp(getOrderTotal()) }}</span>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="customer-info" *ngIf="currentOrder.length > 0">
        <h4>Customer Information</h4>
        <ion-item lines="none">
          <ion-label position="stacked">Customer Name (Optional)</ion-label>
          <ion-input [(ngModel)]="customerName" placeholder="Enter customer name"></ion-input>
        </ion-item>
        
        <ion-item lines="none">
          <ion-label position="stacked">Phone Number (Optional)</ion-label>
          <ion-input [(ngModel)]="currentDetailedOrder.customerPhone" placeholder="Enter phone number"></ion-input>
        </ion-item>
        
        <ion-item lines="none">
          <ion-label position="stacked">Order Type</ion-label>
          <ion-select [(ngModel)]="orderType">
            <ion-select-option value="dine-in">Dine In</ion-select-option>
            <ion-select-option value="takeout">Takeout</ion-select-option>
            <ion-select-option value="delivery">Delivery</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item lines="none">
          <ion-label position="stacked">Special Instructions (Optional)</ion-label>
          <ion-textarea [(ngModel)]="currentDetailedOrder.notes" placeholder="Any special requests..." rows="2"></ion-textarea>
        </ion-item>
      </div>

      <!-- Payment Method -->
      <div class="payment-method" *ngIf="currentOrder.length > 0">
        <h4>Payment Method</h4>
        <div class="payment-options">
          <button 
            class="payment-btn"
            [class.active]="paymentMethod === 'cash'"
            (click)="setPaymentMethod('cash')">
            <ion-icon name="cash-outline"></ion-icon>
            <span>Cash</span>
          </button>
          <button 
            class="payment-btn"
            [class.active]="paymentMethod === 'card'"
            (click)="setPaymentMethod('card')">
            <ion-icon name="card-outline"></ion-icon>
            <span>Card</span>
          </button>
          <button 
            class="payment-btn"
            [class.active]="paymentMethod === 'gcash'"
            (click)="setPaymentMethod('gcash')">
            <ion-icon name="phone-portrait-outline"></ion-icon>
            <span>GCash</span>
          </button>
        </div>
      </div>

      <!-- Process Order Button -->
      <div class="process-order-section" *ngIf="currentOrder.length > 0">
        <button class="process-order-btn" (click)="processOrder()">
          Add to Billing
        </button>
      </div>
    </div>

  </div>
</ion-content>
