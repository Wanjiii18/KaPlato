<div class="dashboard-layout">
  <!-- Mobile Top Bar (visible only on mobile) -->
  <div class="mobile-top-bar">
    <div class="mobile-brand" (click)="navigateToSettings()">
      <div class="brand-icon">{{ getKarenderiaBrandInitials() }}</div>
      <div class="brand-info">
        <h3>{{ getKarenderiaDisplayName() }}</h3>
        <span>Dashboard</span>
      </div>
    </div>
    <div class="mobile-actions">
      <ion-button fill="clear" size="small" routerLink="/karenderia-settings">
        <ion-icon name="person-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" size="small" (click)="logout()">
        <ion-icon name="log-out-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <div class="brand-icon">{{ getKarenderiaBrandInitials() }}</div>
        <div class="brand-info">
          <h3>{{ getKarenderiaDisplayName() }}</h3>
          <span>Owner Dashboard</span>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-item active">
        <ion-icon name="grid-outline"></ion-icon>
        <span>Dashboard</span>
      </div>
      <div class="nav-item" (click)="navigateToMenu()">
        <ion-icon name="restaurant-outline"></ion-icon>
        <span>Menu Management</span>
      </div>
      <div class="nav-item desktop-only" routerLink="/karenderia-settings">
        <ion-icon name="person-outline"></ion-icon>
        <span>Profile</span>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="nav-item" (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
        <span>Sign Out</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <div class="top-header">
      <div class="header-left">
        <h1>{{ getKarenderiaDisplayName() }}</h1>
        <span class="header-subtitle">Owner Dashboard</span>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area" *ngIf="!isLoading">
      <!-- Top Metrics Cards -->
      <div class="metrics-grid">
        <div class="metric-card sales-card">
          <div class="metric-icon">
            <ion-icon name="wallet-outline"></ion-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ formatPhp(todaysSales?.totalSales || 15420) }}</div>
            <div class="metric-label">Total Sales</div>
            <div class="metric-trend positive">
              <span>+25% from yesterday</span>
            </div>
          </div>
        </div>

        <div class="metric-card avg-order-card">
          <div class="metric-icon">
            <ion-icon name="restaurant-outline"></ion-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ dashboardData.activeMenuItems || 25 }}</div>
            <div class="metric-label">Active Menu Items</div>
            <div class="metric-trend positive">
              <span>Updated daily</span>
            </div>
          </div>
        </div>

        <div class="metric-card rating-card">
          <div class="metric-icon">
            <ion-icon name="star-outline"></ion-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">4.7</div>
            <div class="metric-label">Customer Rating</div>
            <div class="metric-trend positive">
              <span>+0.2 from last week</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="dashboard-grid">
        <!-- Low Stock Alerts -->
        <div class="dashboard-card recent-orders">
          <div class="card-header">
            <h3>Low Stock Alerts</h3>
          </div>
          <div class="card-content">
            <div class="order-item" *ngFor="let alert of lowStockAlerts">
              <div class="order-status-dot warning"></div>
              <div class="order-info">
                <div class="order-id">{{ alert.ingredient_name }}</div>
                <div class="order-customer">{{ alert.current_stock }} remaining</div>
                <div class="order-items">Reorder level: {{ alert.minimum_stock }}</div>
              </div>
              <div class="order-meta">
                <div class="order-amount">Low Stock</div>
                <div class="order-time">{{ alert.updated_at | date:'short' }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Menu Status -->
        <div class="dashboard-card order-status">
          <div class="card-header">
            <h3>Menu Status</h3>
          </div>
          <div class="card-content">
            <div class="status-item">
              <div class="status-info">
                <span class="status-label">Active Items</span>
                <span class="status-count">{{ dashboardData.activeMenuItems || 25 }}</span>
              </div>
            </div>
            <div class="status-item">
              <div class="status-info">
                <span class="status-label">Low Stock</span>
                <span class="status-count">{{ dashboardData.lowStockItems || 3 }}</span>
              </div>
            </div>
            <div class="completion-rate">
              <div class="completion-label">87% completion rate</div>
              <div class="completion-bar">
                <div class="completion-fill" style="width: 87%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Low Stock Alert -->
        <div class="dashboard-card low-stock">
          <div class="card-header">
            <h3><ion-icon name="alert-circle-outline"></ion-icon> Low Stock Alert</h3>
          </div>
          <div class="card-content">
            <div class="stock-item">
              <div class="stock-info">
                <span class="stock-name">Pork Belly</span>
                <span class="stock-amount">2 kg left</span>
              </div>
              <div class="stock-status critical">Low</div>
            </div>
            <div class="stock-item">
              <div class="stock-info">
                <span class="stock-name">Tamarind</span>
                <span class="stock-amount">1 pack left</span>
              </div>
              <div class="stock-status critical">Low</div>
            </div>
            <div class="stock-item">
              <div class="stock-info">
                <span class="stock-name">Rice</span>
                <span class="stock-amount">5 kg left</span>
              </div>
              <div class="stock-status critical">Low</div>
            </div>
          </div>
        </div>

        <!-- Top Performing Meals -->
        <div class="dashboard-card top-meals">
          <div class="card-header">
            <h3>Top Performing Meals</h3>
          </div>
          <div class="card-content">
            <div class="meal-item">
              <div class="meal-info">
                <span class="meal-name">Adobong Manok</span>
                <div class="meal-stats">
                  <span class="meal-orders">Orders: 23</span>
                  <span class="meal-revenue">Revenue: {{ formatPhp(6958) }}</span>
                </div>
                <div class="meal-trend">Trend: +4%</div>
              </div>
            </div>
            <div class="meal-item">
              <div class="meal-info">
                <span class="meal-name">Sinigang na Baboy</span>
                <div class="meal-stats">
                  <span class="meal-orders">Orders: 18</span>
                  <span class="meal-revenue">Revenue: {{ formatPhp(5770) }}</span>
                </div>
                <div class="meal-trend">Trend: +8%</div>
              </div>
            </div>
            <div class="meal-item">
              <div class="meal-info">
                <span class="meal-name">Kare-Kare</span>
                <div class="meal-stats">
                  <span class="meal-orders">Orders: 15</span>
                  <span class="meal-revenue">Revenue: {{ formatPhp(4800) }}</span>
                </div>
                <div class="meal-trend">Trend: +15%</div>
              </div>
            </div>
            <div class="meal-item">
              <div class="meal-info">
                <span class="meal-name">Lechon Kawali</span>
                <div class="meal-stats">
                  <span class="meal-orders">Orders: 12</span>
                  <span class="meal-revenue">Revenue: {{ formatPhp(4320) }}</span>
                </div>
                <div class="meal-trend">Trend: -3%</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Loading dashboard...</p>
    </div>
  </div>
</div>
