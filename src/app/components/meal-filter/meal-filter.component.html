<div class="meal-filter-container">
  <!-- Quick Filter Presets -->
  <div class="filter-presets">
    <h4>Quick Filters</h4>
    <div class="preset-chips">
      <ion-chip (click)="applyPreset('budget-friendly')" color="primary" outline="true">
        <ion-icon name="cash-outline"></ion-icon>
        <ion-label>Budget Friendly</ion-label>
      </ion-chip>
      <ion-chip (click)="applyPreset('low-calorie')" color="success" outline="true">
        <ion-icon name="fitness-outline"></ion-icon>
        <ion-label>Low Calorie</ion-label>
      </ion-chip>
      <ion-chip (click)="applyPreset('allergen-safe')" color="warning" outline="true" *ngIf="userAllergens.length > 0">
        <ion-icon name="shield-checkmark-outline"></ion-icon>
        <ion-label>Allergy Safe</ion-label>
      </ion-chip>
      <ion-chip (click)="applyPreset('vegetarian')" color="secondary" outline="true">
        <ion-icon name="leaf-outline"></ion-icon>
        <ion-label>Vegetarian</ion-label>
      </ion-chip>
      <ion-chip (click)="applyPreset('nearby')" color="tertiary" outline="true" *ngIf="showDistanceFilter">
        <ion-icon name="location-outline"></ion-icon>
        <ion-label>Nearby</ion-label>
      </ion-chip>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <ion-searchbar 
      [(ngModel)]="filters.searchQuery" 
      placeholder="Search meals, ingredients, or karenderia..."
      mode="ios"
      class="filter-searchbar"
      (ionInput)="onFilterChange()">
      <ion-icon name="search-outline" slot="start"></ion-icon>
    </ion-searchbar>
  </div>

  <!-- Category Filter -->
  <div class="filter-section">
    <h4>Category</h4>
    <div class="category-scroll">
      <ion-chip 
        *ngFor="let category of categories"
        class="category-chip"
        [class.active]="filters.category === category.id"
        (click)="onCategorySelect(category.id)">
        <ion-icon [name]="category.icon"></ion-icon>
        <ion-label>{{ category.name }}</ion-label>
      </ion-chip>
    </div>
  </div>

  <!-- Quick Toggles -->
  <div class="filter-section">
    <h4>Dietary Preferences</h4>
    <div class="toggle-group">
      <ion-item lines="none" class="toggle-item">
        <ion-icon name="shield-checkmark-outline" slot="start" color="warning"></ion-icon>
        <ion-label>Allergy Safe</ion-label>
        <ion-toggle 
          slot="end" 
          [(ngModel)]="filters.allergenSafe" 
          (ionChange)="toggleAllergenSafe()"
          [disabled]="userAllergens.length === 0"></ion-toggle>
      </ion-item>
      <ion-item lines="none" class="toggle-item">
        <ion-icon name="leaf-outline" slot="start" color="success"></ion-icon>
        <ion-label>Vegetarian</ion-label>
        <ion-toggle 
          slot="end" 
          [(ngModel)]="filters.isVegetarian" 
          (ionChange)="toggleVegetarian()"></ion-toggle>
      </ion-item>
      <ion-item lines="none" class="toggle-item">
        <ion-icon name="flower-outline" slot="start" color="secondary"></ion-icon>
        <ion-label>Vegan</ion-label>
        <ion-toggle 
          slot="end" 
          [(ngModel)]="filters.isVegan" 
          (ionChange)="toggleVegan()"></ion-toggle>
      </ion-item>
    </div>
  </div>

  <!-- Advanced Filters Toggle -->
  <div class="filter-section">
    <ion-button 
      fill="clear" 
      expand="block" 
      (click)="toggleAdvanced()"
      class="advanced-toggle">
      <ion-icon [name]="showAdvanced ? 'chevron-up' : 'chevron-down'" slot="start"></ion-icon>
      Advanced Filters
      <ion-badge color="primary" *ngIf="getActiveFiltersCount() > 0">{{ getActiveFiltersCount() }}</ion-badge>
    </ion-button>
  </div>

  <!-- Advanced Filters -->
  <div *ngIf="showAdvanced" class="advanced-filters">
    
    <!-- Budget Range -->
    <div class="filter-section">
      <h4>Budget Range</h4>
      <div class="range-container">
        <ion-item lines="none">
          <ion-label position="stacked">{{ getBudgetRangeText() }}</ion-label>
          <div class="dual-range">
            <div class="range-input">
              <ion-label>Min: ₱</ion-label>
              <ion-input 
                type="number" 
                [(ngModel)]="filters.minBudget" 
                placeholder="0"
                min="0"
                max="500"
                (ionBlur)="onBudgetChange()"></ion-input>
            </div>
            <div class="range-input">
              <ion-label>Max: ₱</ion-label>
              <ion-input 
                type="number" 
                [(ngModel)]="filters.maxBudget" 
                placeholder="500"
                min="0"
                max="1000"
                (ionBlur)="onBudgetChange()"></ion-input>
            </div>
          </div>
        </ion-item>
      </div>
    </div>

    <!-- Calorie Range -->
    <div class="filter-section">
      <h4>Calorie Range</h4>
      <div class="range-container">
        <ion-item lines="none">
          <ion-label position="stacked">{{ getCalorieRangeText() }}</ion-label>
          <div class="dual-range">
            <div class="range-input">
              <ion-label>Min:</ion-label>
              <ion-input 
                type="number" 
                [(ngModel)]="filters.minCalories" 
                placeholder="0"
                min="0"
                max="2000"
                (ionBlur)="onCalorieChange()"></ion-input>
            </div>
            <div class="range-input">
              <ion-label>Max:</ion-label>
              <ion-input 
                type="number" 
                [(ngModel)]="filters.maxCalories" 
                placeholder="1000"
                min="0"
                max="2000"
                (ionBlur)="onCalorieChange()"></ion-input>
            </div>
          </div>
        </ion-item>
      </div>
    </div>

    <!-- Spicy Level -->
    <div class="filter-section">
      <h4>Spice Level</h4>
      <div class="spicy-scroll">
        <ion-chip 
          *ngFor="let level of spicyLevels"
          class="spicy-chip"
          [class.active]="filters.spicyLevel === level.id"
          (click)="onSpicyLevelSelect(level.id)">
          <ion-icon [name]="level.icon"></ion-icon>
          <ion-label>{{ level.name }}</ion-label>
        </ion-chip>
      </div>
    </div>

    <!-- Distance Filter (if enabled) -->
    <div class="filter-section" *ngIf="showDistanceFilter">
      <h4>Distance</h4>
      <ion-item lines="none">
        <ion-label position="stacked">{{ getDistanceText() }}</ion-label>
        <ion-range 
          [(ngModel)]="filters.maxDistance" 
          min="1" 
          max="20" 
          step="1" 
          snaps="true"
          color="primary"
          (ionChange)="onFilterChange()">
          <ion-label slot="start">1km</ion-label>
          <ion-label slot="end">20km</ion-label>
        </ion-range>
      </ion-item>
    </div>

    <!-- Sort Options -->
    <div class="filter-section">
      <h4>Sort By</h4>
      <ion-select 
        [(ngModel)]="filters.sortBy" 
        placeholder="Choose sorting"
        interface="popover"
        (ionChange)="onSortChange()">
        <ion-select-option *ngFor="let option of sortOptions" [value]="option.id">
          {{ option.name }}
        </ion-select-option>
      </ion-select>
      
      <ion-segment 
        [(ngModel)]="filters.sortOrder" 
        (ionChange)="onSortChange()"
        class="sort-order">
        <ion-segment-button value="asc">
          <ion-label>Low to High</ion-label>
        </ion-segment-button>
        <ion-segment-button value="desc">
          <ion-label>High to Low</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>
  </div>

  <!-- Reset Button -->
  <div class="filter-actions">
    <ion-button 
      fill="outline" 
      expand="block" 
      color="medium"
      (click)="resetFilters()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Reset All Filters
    </ion-button>
  </div>
</div>
