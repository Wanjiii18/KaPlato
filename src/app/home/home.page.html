<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <div class="header-title">
        <ion-icon name="restaurant" color="primary"></ion-icon>
        <span>KaPlato</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToProfile()" fill="clear">
        <ion-avatar slot="icon-only" class="profile-avatar">
          <ion-icon name="person-circle" color="medium"></ion-icon>
        </ion-avatar>
      </ion-button>
      <ion-button (click)="logout()" fill="clear" color="medium">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-dashboard">
  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading...</p>
  </div>

  <!-- Main content when user is authenticated -->
  <div *ngIf="!isLoading && currentUser" class="dashboard-content">
    
    <!-- Search Bar -->
    <div class="search-section">
      <ion-searchbar 
        [(ngModel)]="searchQuery" 
        placeholder="Search for restaurants, food..."
        mode="ios"
        class="custom-searchbar">
      </ion-searchbar>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <ion-segment [(ngModel)]="selectedTab" mode="md">
        <ion-segment-button value="favorites">
          <ion-icon name="heart-outline"></ion-icon>
          <ion-label>Favorites</ion-label>
        </ion-segment-button>
        <ion-segment-button value="history">
          <ion-icon name="time-outline"></ion-icon>
          <ion-label>History</ion-label>
        </ion-segment-button>
        <ion-segment-button value="following">
          <ion-icon name="people-outline"></ion-icon>
          <ion-label>Following</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Banner Section -->
    <div class="banner-section">
      <ion-card class="banner-card">
        <div class="banner-content">
          <div class="banner-text">
            <h2>Welcome to KaPlato!</h2>
            <p>Discover amazing local restaurants</p>
          </div>
          <div class="banner-image">
            <ion-icon name="restaurant" size="large" color="warning"></ion-icon>
          </div>
        </div>
      </ion-card>
    </div>

    <!-- Quick Actions -->
    <div class="section-header">
      <h3>Quick Actions</h3>
      <ion-button fill="clear" size="small">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </ion-button>
    </div>

    <div class="quick-actions">
      <ion-card button (click)="openMealPlanner()" class="action-card">
        <ion-card-content>
          <div class="action-icon">
            <ion-icon name="calendar-outline" color="primary"></ion-icon>
          </div>
          <h4>Meal Planner</h4>
        </ion-card-content>
      </ion-card>

      <ion-card button (click)="toggleMap()" class="action-card">
        <ion-card-content>
          <div class="action-icon">
            <ion-icon name="map-outline" color="success"></ion-icon>
          </div>
          <h4>Find Nearby</h4>
        </ion-card-content>
      </ion-card>

      <ion-card button (click)="addTestData()" class="action-card">
        <ion-card-content>
          <div class="action-icon">
            <ion-icon name="add-circle-outline" color="secondary"></ion-icon>
          </div>
          <h4>Add Test Data</h4>
        </ion-card-content>
      </ion-card>

      <ion-card button (click)="viewSuggestedKarenderias()" class="action-card">
        <ion-card-content>
          <div class="action-icon">
            <ion-icon name="star-outline" color="tertiary"></ion-icon>
          </div>
          <h4>Suggested</h4>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Featured Restaurants -->
    <div class="section-header">
      <h3>Featured Restaurants</h3>
      <ion-button fill="clear" size="small">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </ion-button>
    </div>

    <div class="featured-restaurants">
      <div class="restaurant-card" *ngFor="let restaurant of featuredKarenderias">
        <div class="restaurant-image">
          <ion-icon name="restaurant" size="large" color="medium"></ion-icon>
        </div>
        <div class="restaurant-info">
          <h4>{{ restaurant.name || 'Restaurant' }}</h4>
          <p>{{ restaurant.cuisine || 'Filipino Cuisine' }}</p>
          <div class="rating">
            <ion-icon name="star" color="warning"></ion-icon>
            <span>{{ restaurant.rating || '4.5' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Section -->
    <div *ngIf="showMap" class="map-section">
      <div class="section-header">
        <h3>Nearby Restaurants</h3>
        <ion-button fill="clear" size="small" (click)="toggleMap()">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </div>
      <div class="map-container">
        <app-map></app-map>
      </div>
    </div>

  </div>

  <!-- Not authenticated -->
  <div *ngIf="!isLoading && !currentUser" class="loading-container">
    <p>Not authenticated. Redirecting...</p>
  </div>
</ion-content>
