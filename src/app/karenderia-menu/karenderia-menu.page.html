<div class="dashboard-layout">
  <!-- Mobile Top Bar (visible only on mobile) -->
  <div class="mobile-top-bar">
    <div class="mobile-brand" routerLink="/karenderia-settings">
      <div class="brand-icon">{{getKarenderiaBrandInitials()}}</div>
      <div class="brand-info">
        <h3>{{getKarenderiaDisplayName()}}</h3>
        <span>Menu Management</span>
      </div>
    </div>
    <div class="mobile-actions">
      <ion-button fill="clear" size="small" routerLink="/karenderia-settings">
        <ion-icon name="person-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" size="small" (click)="logout()">
        <ion-icon name="log-out-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <div class="brand-icon">{{getKarenderiaBrandInitials()}}</div>
        <div class="brand-info">
          <h3>{{getKarenderiaDisplayName()}}</h3>
          <span>Kitchen</span>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-item" (click)="navigateToDashboard()">
        <ion-icon name="grid-outline"></ion-icon>
        <span>Dashboard</span>
      </div>
      <div class="nav-item active">
        <ion-icon name="restaurant-outline"></ion-icon>
        <span>Menu Management</span>
      </div>
      <div class="nav-item" (click)="navigateToDailyMenu()">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>Menu of the Day</span>
      </div>
      <div class="nav-item" (click)="navigateToInventory()">
        <ion-icon name="cube-outline"></ion-icon>
        <span>Inventory</span>
      </div>
      <div class="nav-item" (click)="navigateToAnalytics()">
        <ion-icon name="analytics-outline"></ion-icon>
        <span>Analytics</span>
      </div>
      <div class="nav-item desktop-only" routerLink="/karenderia-settings">
        <ion-icon name="person-outline"></ion-icon>
        <span>Profile</span>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="nav-item" (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
        <span>Sign Out</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <div class="top-header">
      <div class="header-left">
        <h1>Menu Management</h1>
        <span class="header-subtitle">Manage your meals</span>
      </div>
      <div class="header-right">
        <ion-button fill="solid" color="primary" (click)="startAddingItem()" *ngIf="!isAddingItem" class="add-meal-btn">
          <ion-icon name="add" slot="start"></ion-icon>
          Add New Meal
        </ion-button>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Tabs Section -->
      <div class="menu-tabs">
        <div class="tab-item active">
          <span>Menu Items</span>
        </div>
        <div class="tab-item">
          <span>Inventory</span>
        </div>
      </div>

      <!-- Search and Filter Section -->
      <div class="search-filter-section">
        <div class="search-container">
          <ion-searchbar 
            placeholder="Search meals..." 
            show-clear-button="focus"
            class="custom-searchbar">
          </ion-searchbar>
        </div>
        <div class="filter-container">
          <ion-select 
            placeholder="All Categories" 
            interface="popover"
            class="category-select">
            <ion-select-option value="all">All Categories</ion-select-option>
            <ion-select-option value="appetizers">Appetizers</ion-select-option>
            <ion-select-option value="main">Main Course</ion-select-option>
            <ion-select-option value="desserts">Desserts</ion-select-option>
            <ion-select-option value="beverages">Beverages</ion-select-option>
          </ion-select>
        </div>
      </div>

      <!-- Modern Add Menu Item Form -->
      <div *ngIf="isAddingItem" class="modern-add-item-section animate-slide-up">
      <ion-card class="modern-add-item-card">
        <ion-card-header>
          <div class="card-header">
            <div class="header-icon">
              <ion-icon [name]="editingItemId ? 'create' : 'add-circle'" color="primary"></ion-icon>
            </div>
            <div class="header-content">
              <h2>{{ editingItemId ? 'Edit Menu Item' : 'Add New Menu Item' }}</h2>
              <p>{{ editingItemId ? 'Update your dish details' : 'Create a delicious new dish for your customers' }}</p>
            </div>
            <ion-button fill="clear" (click)="cancelAddingItem()" class="close-btn">
              <ion-icon name="close" color="medium"></ion-icon>
            </ion-button>
          </div>
        </ion-card-header>

        <ion-card-content>

        <form class="modern-menu-form">
          <!-- Basic Information Section -->
          <div class="form-section">
            <div class="section-header">
              <ion-icon name="information-circle" color="primary"></ion-icon>
              <h3>Basic Information</h3>
            </div>
            
            <div class="input-group">
              <ion-item class="modern-item">
                <ion-input 
                  [(ngModel)]="newMenuItem.name" 
                  label="Dish Name *"
                  labelPlacement="stacked"
                  placeholder="Enter delicious dish name"
                  class="modern-input">
                </ion-input>
              </ion-item>
              
              <ion-item class="modern-item">
                <ion-textarea 
                  [(ngModel)]="newMenuItem.description" 
                  label="Description *"
                  labelPlacement="stacked"
                  placeholder="Describe your dish in detail"
                  rows="3"
                  class="modern-textarea">
                </ion-textarea>
              </ion-item>
            </div>
          </div>

          <!-- Pricing & Category Section -->
          <div class="form-section">
            <div class="section-header">
              <ion-icon name="pricetag" color="success"></ion-icon>
              <h3>Pricing & Category</h3>
            </div>
            
            <div class="form-grid">
              <ion-item class="modern-item">
                <ion-input 
                  [(ngModel)]="newMenuItem.price" 
                  type="number" 
                  label="Price (PHP) *"
                  labelPlacement="stacked"
                  placeholder="0.00"
                  class="modern-input">
                </ion-input>
              </ion-item>
              
              <ion-item class="modern-item">
                <ion-select 
                  [(ngModel)]="newMenuItem.category"
                  label="Category"
                  labelPlacement="stacked"
                  placeholder="Select category"
                  class="modern-select">
                  <ion-select-option value="appetizers">Appetizers</ion-select-option>
                  <ion-select-option value="main">Main Course</ion-select-option>
                  <ion-select-option value="desserts">Desserts</ion-select-option>
                  <ion-select-option value="beverages">Beverages</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            
            <ion-item class="modern-item">
              <ion-input 
                [(ngModel)]="newMenuItem.preparationTime" 
                type="number" 
                label="Preparation Time (minutes)"
                labelPlacement="stacked"
                placeholder="15"
                class="modern-input">
              </ion-input>
            </ion-item>
          </div>

          <!-- Dish Type Selection -->
          <div class="form-section">
            <div class="section-header">
              <ion-icon name="restaurant" color="warning"></ion-icon>
              <h3>Dish Type</h3>
            </div>
            
            <ion-item class="modern-item">
              <ion-select 
                [(ngModel)]="selectedDishType" 
                (ionChange)="onDishTypeChange()" 
                label="Choose a dish type for suggested ingredients"
                labelPlacement="stacked"
                placeholder="Select dish type"
                class="modern-select">
                <ion-select-option value="">Custom Recipe</ion-select-option>
                <ion-select-option *ngFor="let dishType of getDishTypes()" [value]="dishType">
                  {{ getDishTypeDisplay(dishType) }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <!-- Ingredient Selection -->
          <div class="form-section" *ngIf="showIngredientSelection">
            <div class="section-header">
              <ion-icon name="nutrition" color="tertiary"></ion-icon>
              <h3>Select Ingredients</h3>
            </div>
            <p class="helper-text">Check the ingredients you want to include. You can modify quantities and costs below.</p>
            
            <div class="ingredient-checkboxes">
              <ion-item *ngFor="let ingredient of commonIngredients[selectedDishType]" class="ingredient-checkbox-item">
                <ion-checkbox 
                  slot="start" 
                  [checked]="isIngredientSelected(ingredient.name)"
                  (ionChange)="toggleIngredient(ingredient, $event.detail.checked)">
                </ion-checkbox>
                <ion-label>
                  <h3>{{ ingredient.name }}</h3>
                  <p>{{ ingredient.quantity }} {{ ingredient.unit }} - {{ formatPhp(ingredient.cost) }}</p>
                </ion-label>
              </ion-item>
            </div>
          </div>

          <!-- Selected Ingredients -->
          <div class="form-section" *ngIf="newMenuItem.selectedIngredients.length > 0">
            <div class="section-header">
              <ion-icon name="checkmark-done" color="success"></ion-icon>
              <h3>Selected Ingredients</h3>
              <ion-button fill="clear" (click)="addCustomIngredient()">
                <ion-icon name="add-circle" slot="start"></ion-icon>
                Add Custom
              </ion-button>
            </div>
            
            <div class="selected-ingredients">
              <ion-item *ngFor="let ingredient of newMenuItem.selectedIngredients; let i = index" class="selected-ingredient-item">
                <div class="ingredient-details">
                  <h4>{{ ingredient.ingredientName }}</h4>
                  <div class="ingredient-meta">
                    <span class="ingredient-quantity">{{ ingredient.quantity }} {{ ingredient.unit }}</span>
                    <span class="ingredient-cost">₱{{ ingredient.cost }}</span>
                    <span *ngIf="ingredient.ingredientId" class="ingredient-id">ID: {{ ingredient.ingredientId }}</span>
                  </div>
                  <div class="ingredient-inputs">
                    <ion-input 
                      type="number" 
                      [value]="ingredient.quantity"
                      (ionBlur)="updateIngredientQuantity(i, +($event.target.value || 0))"
                      placeholder="Quantity">
                    </ion-input>
                    <span class="unit">{{ ingredient.unit }}</span>
                    <ion-input 
                      type="number" 
                      [value]="ingredient.cost"
                      (ionBlur)="updateIngredientCost(i, +($event.target.value || 0))"
                      placeholder="Cost">
                    </ion-input>
                    <span class="currency">PHP</span>
                  </div>
                </div>
                <ion-button 
                  fill="clear" 
                  color="danger" 
                  slot="end" 
                  (click)="removeIngredient(i)">
                  <ion-icon name="trash"></ion-icon>
                </ion-button>
              </ion-item>
              
              <div class="total-cost">
                <h3>Total Ingredient Cost: {{ formatPhp(getTotalCost()) }}</h3>
                <p>Suggested selling price: {{ formatPhp(getTotalCost() * 2.5) }}</p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <ion-button expand="block" fill="clear" (click)="cancelAddingItem()" class="cancel-btn">
              <ion-icon name="close" slot="start"></ion-icon>
              Cancel
            </ion-button>
            <ion-button expand="block" (click)="saveMenuItem()" [disabled]="!newMenuItem.name || !newMenuItem.description || newMenuItem.price <= 0" class="save-btn">
              <ion-icon name="checkmark" slot="start"></ion-icon>
              {{ editingItemId ? 'Update Menu Item' : 'Save Menu Item' }}
            </ion-button>
          </div>
        </form>
        </ion-card-content>
      </ion-card>
    </div>
    
    <!-- Menu Management Dashboard -->
    <div class="menu-dashboard" *ngIf="!isAddingItem">
      <!-- Menu Items Grid -->
      <div class="menu-items-grid">
        <div class="menu-item-card" *ngFor="let item of filteredMenuItems">
          <div class="card-image">
            <img [src]="getItemImage(item)" [alt]="item.name">
          </div>
          
          <div class="card-content">
            <div class="card-header">
              <h3 class="item-name">{{ item.name }}</h3>
              <div class="category-badge">{{ item.category | titlecase }}</div>
            </div>
            
            <p class="item-description">{{ item.description }}</p>
            
            <div class="item-details">
              <div class="detail-row">
                <span class="detail-label">Price:</span>
                <span class="detail-value price">₱{{ item.price }}</span>
              </div>
              
              <div class="detail-row">
                <span class="detail-label">Cost:</span>
                <span class="detail-value cost">₱{{ getItemCost(item) }}</span>
              </div>
              
              <div class="detail-row">
                <span class="detail-label">Profit:</span>
                <span class="detail-value profit">₱{{ getItemProfit(item) }}</span>
              </div>
              
              <div class="detail-row">
                <span class="detail-label">Prep Time:</span>
                <span class="detail-value">{{ item.preparationTime || '15-20' }} min</span>
              </div>
            </div>
            
            <div class="card-actions">
              <ion-button 
                fill="clear" 
                size="small"
                color="medium" 
                (click)="editMenuItem(item)"
                class="edit-btn">
                <ion-icon name="create-outline" slot="start"></ion-icon>
                Edit
              </ion-button>
              
              <ion-button 
                fill="clear" 
                size="small"
                color="danger" 
                (click)="deleteMenuItem(item)"
                class="delete-btn">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredMenuItems.length === 0">
        <div class="empty-icon">
          <ion-icon name="restaurant-outline"></ion-icon>
        </div>
        <h2>No menu items found</h2>
        <p>Start building your menu by adding your first delicious item</p>
        <ion-button (click)="startAddingItem()" class="add-first-item-btn">
          <ion-icon name="add" slot="start"></ion-icon>
          Add Your First Menu Item
        </ion-button>
      </div>
    </div>
  </div>
</div>
